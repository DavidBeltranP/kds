{
	"info": {
		"_postman_id": "kds-centralizado-2024",
		"name": "KDS Centralizado",
		"description": "Kitchen Display System - Arquitectura Centralizada\n\nEndpoints para validar el funcionamiento del sistema KDS centralizado donde las pantallas se identifican por n√∫mero (/kds1, /kds2, etc.)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:3001/api",
			"type": "string"
		},
		{
			"key": "token",
			"value": "",
			"type": "string"
		},
		{
			"key": "screenId",
			"value": "",
			"type": "string"
		},
		{
			"key": "apiKey",
			"value": "",
			"type": "string"
		},
		{
			"key": "queueId",
			"value": "",
			"type": "string"
		},
		{
			"key": "orderId",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "1. Auth",
			"description": "Autenticaci√≥n - Ejecutar primero para obtener token",
			"item": [
				{
					"name": "Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData.accessToken) {",
									"    pm.collectionVariables.set('token', jsonData.accessToken);",
									"    console.log('Token guardado correctamente');",
									"}",
									"",
									"pm.test('Login exitoso', function() {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(jsonData.accessToken).to.exist;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"admin@example.com\",\n    \"password\": \"REDACTED_PASSWORD\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["auth", "login"]
						},
						"description": "Iniciar sesi√≥n y obtener token JWT"
					}
				}
			]
		},
		{
			"name": "2. Pantallas Centralizadas",
			"description": "Endpoints p√∫blicos para el sistema centralizado de pantallas",
			"item": [
				{
					"name": "Obtener KDS1 por n√∫mero",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData.screenId) {",
									"    pm.collectionVariables.set('screenId', jsonData.screenId);",
									"    pm.collectionVariables.set('apiKey', jsonData.apiKey);",
									"}",
									"",
									"pm.test('Pantalla encontrada', function() {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(jsonData.screenNumber).to.equal(1);",
									"    pm.expect(jsonData.screenName).to.equal('KDS1');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/screens/by-number/1",
							"host": ["{{baseUrl}}"],
							"path": ["screens", "by-number", "1"]
						},
						"description": "Obtener configuraci√≥n de pantalla KDS1 (endpoint p√∫blico)"
					}
				},
				{
					"name": "Obtener KDS2 por n√∫mero",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Pantalla 2 encontrada', function() {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.screenNumber).to.equal(2);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/screens/by-number/2",
							"host": ["{{baseUrl}}"],
							"path": ["screens", "by-number", "2"]
						},
						"description": "Obtener configuraci√≥n de pantalla KDS2"
					}
				},
				{
					"name": "Obtener KDS3 por n√∫mero",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Pantalla 3 encontrada', function() {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.screenNumber).to.equal(3);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/screens/by-number/3",
							"host": ["{{baseUrl}}"],
							"path": ["screens", "by-number", "3"]
						},
						"description": "Obtener configuraci√≥n de pantalla KDS3"
					}
				},
				{
					"name": "Pantalla inexistente (404)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Pantalla no encontrada', function() {",
									"    pm.response.to.have.status(404);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/screens/by-number/99",
							"host": ["{{baseUrl}}"],
							"path": ["screens", "by-number", "99"]
						},
						"description": "Verificar que pantalla inexistente retorna 404"
					}
				}
			]
		},
		{
			"name": "3. Screens (Admin)",
			"description": "Gesti√≥n de pantallas (requiere autenticaci√≥n)",
			"item": [
				{
					"name": "Listar todas las pantallas",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Lista de pantallas', function() {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/screens",
							"host": ["{{baseUrl}}"],
							"path": ["screens"]
						}
					}
				},
				{
					"name": "Obtener pantalla por ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/screens/{{screenId}}",
							"host": ["{{baseUrl}}"],
							"path": ["screens", "{{screenId}}"]
						}
					}
				},
				{
					"name": "Obtener configuraci√≥n completa",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/screens/{{screenId}}/config",
							"host": ["{{baseUrl}}"],
							"path": ["screens", "{{screenId}}", "config"]
						},
						"description": "Obtener appearance, preference, keyboard config"
					}
				}
			]
		},
		{
			"name": "4. Queues",
			"description": "Gesti√≥n de colas",
			"item": [
				{
					"name": "Listar colas",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData.length > 0) {",
									"    pm.collectionVariables.set('queueId', jsonData[0].id);",
									"}",
									"",
									"pm.test('Lista de colas', function() {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(jsonData).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/queues",
							"host": ["{{baseUrl}}"],
							"path": ["queues"]
						}
					}
				},
				{
					"name": "Obtener cola por ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/queues/{{queueId}}",
							"host": ["{{baseUrl}}"],
							"path": ["queues", "{{queueId}}"]
						}
					}
				}
			]
		},
		{
			"name": "5. Orders",
			"description": "Gesti√≥n de √≥rdenes",
			"item": [
				{
					"name": "Listar √≥rdenes",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData.orders && jsonData.orders.length > 0) {",
									"    pm.collectionVariables.set('orderId', jsonData.orders[0].id);",
									"}",
									"",
									"pm.test('Lista de √≥rdenes', function() {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/orders",
							"host": ["{{baseUrl}}"],
							"path": ["orders"]
						}
					}
				},
				{
					"name": "√ìrdenes por pantalla",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/orders/screen/{{screenId}}",
							"host": ["{{baseUrl}}"],
							"path": ["orders", "screen", "{{screenId}}"]
						}
					}
				},
				{
					"name": "Crear orden de prueba",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData.id) {",
									"    pm.collectionVariables.set('orderId', jsonData.id);",
									"}",
									"",
									"pm.test('Orden creada', function() {",
									"    pm.response.to.have.status(201);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"externalId\": \"TEST-{{$timestamp}}\",\n    \"channel\": \"MOSTRADOR\",\n    \"customerName\": \"Cliente Prueba\",\n    \"identifier\": \"{{$randomInt}}\",\n    \"items\": [\n        {\n            \"name\": \"COMBO MEGA\",\n            \"quantity\": 2,\n            \"notes\": \"Sin salsa\"\n        },\n        {\n            \"name\": \"PAPAS GRANDES\",\n            \"quantity\": 1\n        }\n    ]\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/orders",
							"host": ["{{baseUrl}}"],
							"path": ["orders"]
						}
					}
				},
				{
					"name": "Finalizar orden",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/orders/{{orderId}}/finish",
							"host": ["{{baseUrl}}"],
							"path": ["orders", "{{orderId}}", "finish"]
						}
					}
				},
				{
					"name": "Deshacer finalizaci√≥n",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/orders/{{orderId}}/undo",
							"host": ["{{baseUrl}}"],
							"path": ["orders", "{{orderId}}", "undo"]
						}
					}
				},
				{
					"name": "üß™ Generar √≥rdenes de prueba",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('√ìrdenes generadas', function() {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"count\": 5,\n    \"includeLong\": true,\n    \"includeExtraLong\": false\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/orders/generate-test",
							"host": ["{{baseUrl}}"],
							"path": ["orders", "generate-test"]
						},
						"description": "Genera √≥rdenes de prueba con externalId que empieza con TEST-"
					}
				},
				{
					"name": "üóëÔ∏è Eliminar TODAS las √≥rdenes de prueba",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('√ìrdenes eliminadas', function() {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    console.log('Eliminadas: ' + jsonData.count + ' √≥rdenes');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/orders/test-orders",
							"host": ["{{baseUrl}}"],
							"path": ["orders", "test-orders"]
						},
						"description": "‚ö†Ô∏è Elimina TODAS las √≥rdenes cuyo externalId empieza con 'TEST-'"
					}
				},
				{
					"name": "üßπ Limpiar √≥rdenes antiguas",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Limpieza completada', function() {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/orders/cleanup?hours=1",
							"host": ["{{baseUrl}}"],
							"path": ["orders", "cleanup"],
							"query": [
								{
									"key": "hours",
									"value": "1",
									"description": "Eliminar √≥rdenes m√°s antiguas que X horas"
								}
							]
						},
						"description": "Elimina √≥rdenes m√°s antiguas que las horas especificadas"
					}
				}
			]
		},
		{
			"name": "6. Config General",
			"description": "Configuraci√≥n general del sistema",
			"item": [
				{
					"name": "Obtener configuraci√≥n",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/config/general",
							"host": ["{{baseUrl}}"],
							"path": ["config", "general"]
						}
					}
				},
				{
					"name": "Actualizar configuraci√≥n",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"ticketMode\": \"POLLING\",\n    \"printMode\": \"LOCAL\",\n    \"pollingInterval\": 2000,\n    \"orderLifetime\": 4\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/config/general",
							"host": ["{{baseUrl}}"],
							"path": ["config", "general"]
						}
					}
				}
			]
		},
		{
			"name": "7. Appearance",
			"description": "Configuraci√≥n de apariencia por pantalla",
			"item": [
				{
					"name": "Obtener apariencia",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/screens/{{screenId}}/appearance",
							"host": ["{{baseUrl}}"],
							"path": ["screens", "{{screenId}}", "appearance"]
						}
					}
				},
				{
					"name": "Actualizar apariencia",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"columnsPerScreen\": 4,\n    \"theme\": \"DARK\",\n    \"backgroundColor\": \"#1a1a2e\",\n    \"headerColor\": \"#16213e\",\n    \"cardColor\": \"#0f3460\",\n    \"textColor\": \"#ffffff\",\n    \"headerFontSize\": \"large\",\n    \"productFontSize\": \"medium\",\n    \"productUppercase\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/screens/{{screenId}}/appearance",
							"host": ["{{baseUrl}}"],
							"path": ["screens", "{{screenId}}", "appearance"]
						}
					}
				}
			]
		},
		{
			"name": "8. Mirror KDS",
			"description": "Endpoints para modo espejo/monitor (lectura desde KDS2 remoto)",
			"item": [
				{
					"name": "Verificar conexi√≥n Mirror",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/mirror/status",
							"host": ["{{baseUrl}}"],
							"path": ["mirror", "status"]
						}
					}
				},
				{
					"name": "Obtener √≥rdenes Mirror",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/mirror/orders?screen=1",
							"host": ["{{baseUrl}}"],
							"path": ["mirror", "orders"],
							"query": [
								{
									"key": "screen",
									"value": "1"
								}
							]
						},
						"description": "Obtener √≥rdenes desde KDS2 remoto para pantalla espec√≠fica"
					}
				}
			]
		},
		{
			"name": "9. WebSocket Info",
			"description": "Informaci√≥n sobre conexi√≥n WebSocket",
			"item": [
				{
					"name": "Estado WebSocket",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/ws/status",
							"host": ["{{baseUrl}}"],
							"path": ["ws", "status"]
						},
						"description": "Ver pantallas conectadas via WebSocket"
					}
				}
			]
		}
	]
}
